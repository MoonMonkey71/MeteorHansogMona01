<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HA og MB Hjerte Spill</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #ffd3a5 100%);
            font-family: Arial, sans-serif;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: radial-gradient(circle at center, #ffb3ba, #ffdfba);
            border: 3px solid #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }
        
        #instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            text-align: center;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        #score {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="instructions">
        Trykk på HA for å skyte hjerter mot MB!
    </div>
    <div id="score">Hjerter: 0</div>
    <canvas id="gameCanvas"></canvas>
    
    <script>
        class HeartGame {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.setupCanvas();
                
                // Spill tilstand
                this.gameState = 'playing'; // 'playing', 'merged'
                this.hearts = [];
                this.heartCount = 0;
                this.lastShotTime = 0;
                this.shotCooldown = 500; // millisekunder mellom skudd
                
                // Spill objekter
                this.ha = {
                    x: 100,
                    y: this.canvas.height / 2,
                    size: 60,
                    color: '#ff4757',
                    targetX: 100,
                    targetY: this.canvas.height / 2
                };
                
                this.mb = {
                    x: this.canvas.width - 150,
                    y: this.canvas.height / 2,
                    size: 40,
                    color: '#3742fa',
                    growth: 0,
                    maxGrowth: 100
                };
                
                this.bigHeart = {
                    x: this.canvas.width / 2,
                    y: this.canvas.height / 2,
                    size: 0,
                    maxSize: 200,
                    growing: false,
                    pulse: 0
                };
                
                this.setupEventListeners();
                this.gameLoop();
            }
            
            setupCanvas() {
                // Sett canvas størrelse til skjermstørrelse
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                
                // Håndter skjermrotasjon
                window.addEventListener('resize', () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                    this.ha.y = this.canvas.height / 2;
                    this.ha.targetY = this.canvas.height / 2;
                    this.mb.y = this.canvas.height / 2;
                    this.bigHeart.y = this.canvas.height / 2;
                });
            }
            
            setupEventListeners() {
                // Touch events for iOS
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = this.canvas.getBoundingClientRect();
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    this.handleTouch(x, y);
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = this.canvas.getBoundingClientRect();
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    this.handleTouch(x, y);
                });
                
                // Mouse events for testing
                this.canvas.addEventListener('click', (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    this.handleTouch(x, y);
                });
            }
            
            handleTouch(x, y) {
                if (this.gameState === 'merged') return;
                
                // Flytt HA til touch posisjon
                this.ha.targetX = x;
                this.ha.targetY = y;
                
                // Skytt hjerte hvis nok tid har gått
                const now = Date.now();
                if (now - this.lastShotTime > this.shotCooldown) {
                    this.shootHeart();
                    this.lastShotTime = now;
                }
            }
            
            shootHeart() {
                const heart = {
                    x: this.ha.x + this.ha.size / 2,
                    y: this.ha.y + this.ha.size / 2,
                    targetX: this.mb.x + this.mb.size / 2,
                    targetY: this.mb.y + this.mb.size / 2,
                    size: 15,
                    speed: 3,
                    color: '#ff6b9d'
                };
                
                // Beregn retning
                const dx = heart.targetX - heart.x;
                const dy = heart.targetY - heart.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                heart.vx = (dx / distance) * heart.speed;
                heart.vy = (dy / distance) * heart.speed;
                
                this.hearts.push(heart);
            }
            
            update() {
                if (this.gameState === 'merged') {
                    this.updateBigHeart();
                    return;
                }
                
                // Oppdater HA posisjon (smooth movement)
                this.ha.x += (this.ha.targetX - this.ha.x) * 0.1;
                this.ha.y += (this.ha.targetY - this.ha.y) * 0.1;
                
                // Oppdater hjertene
                for (let i = this.hearts.length - 1; i >= 0; i--) {
                    const heart = this.hearts[i];
                    heart.x += heart.vx;
                    heart.y += heart.vy;
                    
                    // Sjekk kollisjon med MB
                    const dx = heart.x - (this.mb.x + this.mb.size / 2);
                    const dy = heart.y - (this.mb.y + this.mb.size / 2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < this.mb.size / 2 + heart.size) {
                        // Treff! MB vokser
                        this.mb.growth += 20;
                        this.mb.size = 40 + (this.mb.growth / this.mb.maxGrowth) * 60;
                        this.hearts.splice(i, 1);
                        this.heartCount++;
                        document.getElementById('score').textContent = `Hjerter: ${this.heartCount}`;
                        
                        // Sjekk om MB er stor nok til å kollidere med HA
                        this.checkHACollision();
                    } else if (heart.x < 0 || heart.x > this.canvas.width || 
                              heart.y < 0 || heart.y > this.canvas.height) {
                        // Fjern hjertene som går utenfor skjermen
                        this.hearts.splice(i, 1);
                    }
                }
            }
            
            checkHACollision() {
                const dx = this.ha.x - this.mb.x;
                const dy = this.ha.y - this.mb.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < (this.ha.size + this.mb.size) / 2) {
                    // Kollisjon! Start stor hjerte animasjon
                    this.gameState = 'merged';
                    this.bigHeart.growing = true;
                    this.hearts = []; // Fjern alle hjertene
                }
            }
            
            updateBigHeart() {
                if (this.bigHeart.growing && this.bigHeart.size < this.bigHeart.maxSize) {
                    this.bigHeart.size += 2;
                } else if (this.bigHeart.size >= this.bigHeart.maxSize) {
                    this.bigHeart.growing = false;
                }
                
                this.bigHeart.pulse += 0.1;
            }
            
            draw() {
                // Tøm canvas
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.gameState === 'merged') {
                    this.drawBigHeart();
                } else {
                    this.drawHA();
                    this.drawMB();
                    this.drawHearts();
                }
            }
            
            drawHA() {
                this.ctx.save();
                this.ctx.fillStyle = this.ha.color;
                this.ctx.font = `bold ${this.ha.size}px Arial`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // Legg til skygge
                this.ctx.shadowColor = 'rgba(0,0,0,0.3)';
                this.ctx.shadowBlur = 10;
                this.ctx.shadowOffsetX = 3;
                this.ctx.shadowOffsetY = 3;
                
                this.ctx.fillText('HA', this.ha.x, this.ha.y);
                this.ctx.restore();
            }
            
            drawMB() {
                this.ctx.save();
                this.ctx.fillStyle = this.mb.color;
                this.ctx.font = `bold ${this.mb.size}px Arial`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // Legg til skygge
                this.ctx.shadowColor = 'rgba(0,0,0,0.3)';
                this.ctx.shadowBlur = 10;
                this.ctx.shadowOffsetX = 3;
                this.ctx.shadowOffsetY = 3;
                
                this.ctx.fillText('MB', this.mb.x, this.mb.y);
                this.ctx.restore();
            }
            
            drawHearts() {
                this.hearts.forEach(heart => {
                    this.ctx.save();
                    this.ctx.fillStyle = heart.color;
                    this.ctx.shadowColor = 'rgba(0,0,0,0.3)';
                    this.ctx.shadowBlur = 5;
                    this.ctx.shadowOffsetX = 2;
                    this.ctx.shadowOffsetY = 2;
                    
                    this.drawHeart(heart.x, heart.y, heart.size);
                    this.ctx.restore();
                });
            }
            
            drawHeart(x, y, size) {
                this.ctx.beginPath();
                const topCurveHeight = size * 0.3;
                this.ctx.moveTo(x, y + topCurveHeight);
                
                // Venstre kurve
                this.ctx.bezierCurveTo(
                    x, y,
                    x - size/2, y,
                    x - size/2, y + topCurveHeight
                );
                
                // Venstre nedre kurve
                this.ctx.bezierCurveTo(
                    x - size/2, y + (size + topCurveHeight)/2,
                    x, y + (size + topCurveHeight)/2,
                    x, y + size
                );
                
                // Høyre nedre kurve
                this.ctx.bezierCurveTo(
                    x, y + (size + topCurveHeight)/2,
                    x + size/2, y + (size + topCurveHeight)/2,
                    x + size/2, y + topCurveHeight
                );
                
                // Høyre kurve
                this.ctx.bezierCurveTo(
                    x + size/2, y,
                    x, y,
                    x, y + topCurveHeight
                );
                
                this.ctx.closePath();
                this.ctx.fill();
            }
            
            drawBigHeart() {
                this.ctx.save();
                
                // Puls effekt
                const pulseScale = 1 + Math.sin(this.bigHeart.pulse) * 0.1;
                const currentSize = this.bigHeart.size * pulseScale;
                
                this.ctx.fillStyle = '#ff6b9d';
                this.ctx.shadowColor = 'rgba(255, 107, 157, 0.5)';
                this.ctx.shadowBlur = 20;
                this.ctx.shadowOffsetX = 0;
                this.ctx.shadowOffsetY = 0;
                
                this.drawHeart(this.bigHeart.x, this.bigHeart.y, currentSize);
                
                // Legg til tekst
                this.ctx.fillStyle = 'white';
                this.ctx.font = 'bold 48px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.shadowColor = 'rgba(0,0,0,0.5)';
                this.ctx.shadowBlur = 10;
                this.ctx.shadowOffsetX = 3;
                this.ctx.shadowOffsetY = 3;
                
                this.ctx.fillText('❤️', this.bigHeart.x, this.bigHeart.y);
                
                this.ctx.restore();
            }
            
            gameLoop() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.gameLoop());
            }
        }
        
        // Start spillet når siden lastes
        window.addEventListener('load', () => {
            new HeartGame();
        });
    </script>
</body>
</html>
